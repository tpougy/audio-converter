var x=Object.defineProperty;var b=n=>{throw TypeError(n)};var M=(n,e,t)=>e in n?x(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var l=(n,e,t)=>M(n,typeof e!="symbol"?e+"":e,t),C=(n,e,t)=>e.has(n)||b("Cannot "+t);var o=(n,e,t)=>(C(n,e,"read from private field"),t?t.call(n):e.get(n)),g=(n,e,t)=>e.has(n)?b("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(n):e.set(n,t),I=(n,e,t,r)=>(C(n,e,"write to private field"),r?r.call(n,t):e.set(n,t),t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const c of i.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&r(c)}).observe(document,{childList:!0,subtree:!0});function t(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=t(s);fetch(s.href,i)}})();const A=100*1024*1024,W=["audio/opus","audio/ogg","audio/ogg; codecs=opus","audio/webm","audio/webm; codecs=opus"],P=[".opus",".ogg"],z="192k",X=".mp3";function _(n){if(n===0)return"0 Bytes";const e=1024,t=["Bytes","KB","MB","GB"],r=Math.floor(Math.log(n)/Math.log(e));return parseFloat((n/Math.pow(e,r)).toFixed(2))+" "+t[r]}function j(n){const e=n.lastIndexOf(".");return e===-1?"":n.substring(e).toLowerCase()}function q(n,e){const t=n.lastIndexOf(".");return t===-1?n+e:n.substring(0,t)+e}function G(n){if(n.size>A)return{valid:!1,error:`Arquivo muito grande. O tamanho máximo é ${_(A)}.`};const e=j(n.name),t=n.type.toLowerCase(),r=P.includes(e),s=W.includes(t)||t.startsWith("audio/");return!r&&!s?{valid:!1,error:"Este formato não é suportado. Por favor, selecione um arquivo .opus ou .ogg"}:{valid:!0,error:null}}function H(n){return{name:n.name,size:_(n.size),type:n.type||"audio/opus"}}function $(n){return q(n,X)}function Z(n,e){const t=URL.createObjectURL(n),r=document.createElement("a");r.href=t,r.download=e,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(t)}function U(){return"share"in navigator&&"canShare"in navigator}function K(){return"serviceWorker"in navigator}class Y{constructor(){l(this,"currentState","initial");l(this,"elements");this.elements={initialState:null,previewState:null,loadingState:null,convertingState:null,completedState:null,errorState:null,dropZone:null,fileInput:null,fileName:null,fileSize:null,fileType:null,progressBar:null,progressText:null,progressMessage:null,outputFileName:null,errorMessage:null,shareButton:null,downloadButton:null,convertButton:null,cancelButton:null,retryButton:null,selectAnotherButton:null,convertAnotherButton:null}}init(){this.elements={initialState:document.getElementById("state-initial"),previewState:document.getElementById("state-preview"),loadingState:document.getElementById("state-loading"),convertingState:document.getElementById("state-converting"),completedState:document.getElementById("state-completed"),errorState:document.getElementById("state-error"),dropZone:document.getElementById("drop-zone"),fileInput:document.getElementById("file-input"),fileName:document.getElementById("file-name"),fileSize:document.getElementById("file-size"),fileType:document.getElementById("file-type"),progressBar:document.getElementById("progress-bar"),progressText:document.getElementById("progress-text"),progressMessage:document.getElementById("progress-message"),outputFileName:document.getElementById("output-file-name"),errorMessage:document.getElementById("error-message"),shareButton:document.getElementById("btn-share"),downloadButton:document.getElementById("btn-download"),convertButton:document.getElementById("btn-convert"),cancelButton:document.getElementById("btn-cancel"),retryButton:document.getElementById("btn-retry"),selectAnotherButton:document.getElementById("btn-select-another"),convertAnotherButton:document.getElementById("btn-convert-another")},!U()&&this.elements.shareButton&&(this.elements.shareButton.style.display="none"),this.setState("initial")}setState(e){switch(this.currentState=e,this.hideAllStates(),e){case"initial":this.showElement(this.elements.initialState);break;case"preview":this.showElement(this.elements.previewState);break;case"loading-ffmpeg":this.showElement(this.elements.loadingState);break;case"converting":this.showElement(this.elements.convertingState);break;case"completed":this.showElement(this.elements.completedState);break;case"error":this.showElement(this.elements.errorState);break}}getState(){return this.currentState}showFilePreview(e){this.elements.fileName&&(this.elements.fileName.textContent=e.name),this.elements.fileSize&&(this.elements.fileSize.textContent=e.size),this.elements.fileType&&(this.elements.fileType.textContent=e.type),this.setState("preview")}updateProgress(e){e.stage==="loading"?this.setState("loading-ffmpeg"):this.setState("converting"),this.elements.progressBar&&(this.elements.progressBar.style.width=`${e.percentage}%`,this.elements.progressBar.setAttribute("aria-valuenow",e.percentage.toString())),this.elements.progressText&&(this.elements.progressText.textContent=`${e.percentage}%`),this.elements.progressMessage&&(this.elements.progressMessage.textContent=e.message)}showCompleted(e){this.elements.outputFileName&&(this.elements.outputFileName.textContent=e),this.setState("completed")}showError(e){this.elements.errorMessage&&(this.elements.errorMessage.textContent=e),this.setState("error")}resetToInitial(){this.elements.fileInput&&(this.elements.fileInput.value=""),this.resetProgress(),this.setState("initial")}setupDragAndDrop(e){const t=this.elements.dropZone;t&&(t.addEventListener("dragover",r=>{r.preventDefault(),r.stopPropagation(),t.classList.add("drag-over")}),t.addEventListener("dragleave",r=>{r.preventDefault(),r.stopPropagation(),t.classList.remove("drag-over")}),t.addEventListener("drop",r=>{var i;r.preventDefault(),r.stopPropagation(),t.classList.remove("drag-over");const s=(i=r.dataTransfer)==null?void 0:i.files;s&&s.length>0&&e(s[0])}),t.addEventListener("click",()=>{var r;(r=this.elements.fileInput)==null||r.click()}))}setupFileInput(e){const t=this.elements.fileInput;t&&t.addEventListener("change",()=>{const r=t.files;r&&r.length>0&&e(r[0])})}onConvertClick(e){var t;(t=this.elements.convertButton)==null||t.addEventListener("click",e)}onCancelClick(e){var t;(t=this.elements.cancelButton)==null||t.addEventListener("click",e)}onRetryClick(e){var t;(t=this.elements.retryButton)==null||t.addEventListener("click",e)}onSelectAnotherClick(e){var t;(t=this.elements.selectAnotherButton)==null||t.addEventListener("click",e)}onConvertAnotherClick(e){var t;(t=this.elements.convertAnotherButton)==null||t.addEventListener("click",e)}onShareClick(e){var t;(t=this.elements.shareButton)==null||t.addEventListener("click",e)}onDownloadClick(e){var t;(t=this.elements.downloadButton)==null||t.addEventListener("click",e)}hideAllStates(){[this.elements.initialState,this.elements.previewState,this.elements.loadingState,this.elements.convertingState,this.elements.completedState,this.elements.errorState].forEach(t=>{t&&t.classList.add("d-none")})}showElement(e){e&&e.classList.remove("d-none")}resetProgress(){this.elements.progressBar&&(this.elements.progressBar.style.width="0%",this.elements.progressBar.setAttribute("aria-valuenow","0")),this.elements.progressText&&(this.elements.progressText.textContent="0%"),this.elements.progressMessage&&(this.elements.progressMessage.textContent="")}}const u=new Y;var a;(function(n){n.LOAD="LOAD",n.EXEC="EXEC",n.FFPROBE="FFPROBE",n.WRITE_FILE="WRITE_FILE",n.READ_FILE="READ_FILE",n.DELETE_FILE="DELETE_FILE",n.RENAME="RENAME",n.CREATE_DIR="CREATE_DIR",n.LIST_DIR="LIST_DIR",n.DELETE_DIR="DELETE_DIR",n.ERROR="ERROR",n.DOWNLOAD="DOWNLOAD",n.PROGRESS="PROGRESS",n.LOG="LOG",n.MOUNT="MOUNT",n.UNMOUNT="UNMOUNT"})(a||(a={}));const V=(()=>{let n=0;return()=>n++})(),J=new Error("ffmpeg is not loaded, call `await ffmpeg.load()` first"),Q=new Error("called FFmpeg.terminate()");var h,E,m,w,R,B,d;class ee{constructor(){g(this,h,null);g(this,E,{});g(this,m,{});g(this,w,[]);g(this,R,[]);l(this,"loaded",!1);g(this,B,()=>{o(this,h)&&(o(this,h).onmessage=({data:{id:e,type:t,data:r}})=>{switch(t){case a.LOAD:this.loaded=!0,o(this,E)[e](r);break;case a.MOUNT:case a.UNMOUNT:case a.EXEC:case a.FFPROBE:case a.WRITE_FILE:case a.READ_FILE:case a.DELETE_FILE:case a.RENAME:case a.CREATE_DIR:case a.LIST_DIR:case a.DELETE_DIR:o(this,E)[e](r);break;case a.LOG:o(this,w).forEach(s=>s(r));break;case a.PROGRESS:o(this,R).forEach(s=>s(r));break;case a.ERROR:o(this,m)[e](r);break}delete o(this,E)[e],delete o(this,m)[e]})});g(this,d,({type:e,data:t},r=[],s)=>o(this,h)?new Promise((i,c)=>{const f=V();o(this,h)&&o(this,h).postMessage({id:f,type:e,data:t},r),o(this,E)[f]=i,o(this,m)[f]=c,s==null||s.addEventListener("abort",()=>{c(new DOMException(`Message # ${f} was aborted`,"AbortError"))},{once:!0})}):Promise.reject(J));l(this,"load",({classWorkerURL:e,...t}={},{signal:r}={})=>(o(this,h)||(I(this,h,e?new Worker(new URL(e,import.meta.url),{type:"module"}):new Worker(new URL("/audio-converter/assets/worker-BAOIWoxA.js",import.meta.url),{type:"module"})),o(this,B).call(this)),o(this,d).call(this,{type:a.LOAD,data:t},void 0,r)));l(this,"exec",(e,t=-1,{signal:r}={})=>o(this,d).call(this,{type:a.EXEC,data:{args:e,timeout:t}},void 0,r));l(this,"ffprobe",(e,t=-1,{signal:r}={})=>o(this,d).call(this,{type:a.FFPROBE,data:{args:e,timeout:t}},void 0,r));l(this,"terminate",()=>{const e=Object.keys(o(this,m));for(const t of e)o(this,m)[t](Q),delete o(this,m)[t],delete o(this,E)[t];o(this,h)&&(o(this,h).terminate(),I(this,h,null),this.loaded=!1)});l(this,"writeFile",(e,t,{signal:r}={})=>{const s=[];return t instanceof Uint8Array&&s.push(t.buffer),o(this,d).call(this,{type:a.WRITE_FILE,data:{path:e,data:t}},s,r)});l(this,"mount",(e,t,r)=>{const s=[];return o(this,d).call(this,{type:a.MOUNT,data:{fsType:e,options:t,mountPoint:r}},s)});l(this,"unmount",e=>{const t=[];return o(this,d).call(this,{type:a.UNMOUNT,data:{mountPoint:e}},t)});l(this,"readFile",(e,t="binary",{signal:r}={})=>o(this,d).call(this,{type:a.READ_FILE,data:{path:e,encoding:t}},void 0,r));l(this,"deleteFile",(e,{signal:t}={})=>o(this,d).call(this,{type:a.DELETE_FILE,data:{path:e}},void 0,t));l(this,"rename",(e,t,{signal:r}={})=>o(this,d).call(this,{type:a.RENAME,data:{oldPath:e,newPath:t}},void 0,r));l(this,"createDir",(e,{signal:t}={})=>o(this,d).call(this,{type:a.CREATE_DIR,data:{path:e}},void 0,t));l(this,"listDir",(e,{signal:t}={})=>o(this,d).call(this,{type:a.LIST_DIR,data:{path:e}},void 0,t));l(this,"deleteDir",(e,{signal:t}={})=>o(this,d).call(this,{type:a.DELETE_DIR,data:{path:e}},void 0,t))}on(e,t){e==="log"?o(this,w).push(t):e==="progress"&&o(this,R).push(t)}off(e,t){e==="log"?I(this,w,o(this,w).filter(r=>r!==t)):e==="progress"&&I(this,R,o(this,R).filter(r=>r!==t))}}h=new WeakMap,E=new WeakMap,m=new WeakMap,w=new WeakMap,R=new WeakMap,B=new WeakMap,d=new WeakMap;var F;(function(n){n.MEMFS="MEMFS",n.NODEFS="NODEFS",n.NODERAWFS="NODERAWFS",n.IDBFS="IDBFS",n.WORKERFS="WORKERFS",n.PROXYFS="PROXYFS"})(F||(F={}));const te=new Error("failed to get response body reader"),ne=new Error("failed to complete download"),re="Content-Length",se=n=>new Promise((e,t)=>{const r=new FileReader;r.onload=()=>{const{result:s}=r;s instanceof ArrayBuffer?e(new Uint8Array(s)):e(new Uint8Array)},r.onerror=s=>{var i,c;t(Error(`File could not be read! Code=${((c=(i=s==null?void 0:s.target)==null?void 0:i.error)==null?void 0:c.code)||-1}`))},r.readAsArrayBuffer(n)}),oe=async n=>{let e;if(typeof n=="string")/data:_data\/([a-zA-Z]*);base64,([^"]*)/.test(n)?e=atob(n.split(",")[1]).split("").map(t=>t.charCodeAt(0)):e=await(await fetch(n)).arrayBuffer();else if(n instanceof URL)e=await(await fetch(n)).arrayBuffer();else if(n instanceof File||n instanceof Blob)e=await se(n);else return new Uint8Array;return new Uint8Array(e)},ie=async(n,e)=>{var s;const t=await fetch(n);let r;try{const i=parseInt(t.headers.get(re)||"-1"),c=(s=t.body)==null?void 0:s.getReader();if(!c)throw te;const f=[];let v=0;for(;;){const{done:p,value:O}=await c.read(),D=O?O.length:0;if(p){if(i!=-1&&i!==v)throw ne;e&&e({url:n,total:i,received:v,delta:D,done:p});break}f.push(O),v+=D,e&&e({url:n,total:i,received:v,delta:D,done:p})}const S=new Uint8Array(v);let y=0;for(const p of f)S.set(p,y),y+=p.length;r=S.buffer}catch(i){console.log("failed to send download progress event: ",i),r=await t.arrayBuffer()}return r},k=async(n,e,t=!1,r)=>{const s=t?await ie(n,r):await(await fetch(n)).arrayBuffer(),i=new Blob([s],{type:e});return URL.createObjectURL(i)};class ae{constructor(){l(this,"ffmpeg",null);l(this,"loaded",!1);l(this,"loading",!1);l(this,"abortController",null)}async load(e){if(!this.loaded){if(this.loading){for(;this.loading;)await new Promise(t=>setTimeout(t,100));return}this.loading=!0;try{this.ffmpeg=new ee,this.ffmpeg.on("log",({message:r})=>{}),this.ffmpeg.on("progress",({progress:r})=>{e&&e({stage:"converting",percentage:Math.round(r*100),message:"Convertendo áudio..."})}),e==null||e({stage:"loading",percentage:0,message:"Carregando conversor..."});const t="https://unpkg.com/@ffmpeg/core@0.12.6/dist/esm";await this.ffmpeg.load({coreURL:await k(`${t}/ffmpeg-core.js`,"text/javascript"),wasmURL:await k(`${t}/ffmpeg-core.wasm`,"application/wasm")}),this.loaded=!0,e==null||e({stage:"loading",percentage:100,message:"Conversor pronto!"})}catch{throw this.ffmpeg=null,new Error("Erro ao carregar o conversor. Verifique sua conexão com a internet e tente novamente.")}finally{this.loading=!1}}}async convert(e,t){const r=Date.now(),s=$(e.name);try{if((!this.ffmpeg||!this.loaded)&&await this.load(t),!this.ffmpeg)throw new Error("FFmpeg não está carregado");this.abortController=new AbortController,t==null||t({stage:"converting",percentage:0,message:"Preparando arquivo..."});const i=await oe(e),c="input"+this.getInputExtension(e.name),f="output.mp3";await this.ffmpeg.writeFile(c,i),t==null||t({stage:"converting",percentage:5,message:"Iniciando conversão..."}),await this.ffmpeg.exec(["-i",c,"-c:a","libmp3lame","-b:a",z,"-y",f]),t==null||t({stage:"finalizing",percentage:95,message:"Finalizando..."});const v=await this.ffmpeg.readFile(f);await this.ffmpeg.deleteFile(c),await this.ffmpeg.deleteFile(f);const S=v,y=new ArrayBuffer(S.byteLength);new Uint8Array(y).set(S);const p=new Blob([y],{type:"audio/mpeg"});return t==null||t({stage:"finalizing",percentage:100,message:"Conversão concluída!"}),{success:!0,outputFile:p,outputFileName:s,error:null,duration:Date.now()-r}}catch(i){const c=i instanceof Error?i.message:"Ocorreu um erro durante a conversão. Por favor, tente novamente.";return{success:!1,outputFile:null,outputFileName:s,error:c,duration:Date.now()-r}}finally{this.abortController=null}}cancel(){this.abortController&&this.abortController.abort(),this.ffmpeg&&(this.ffmpeg.terminate(),this.ffmpeg=null,this.loaded=!1)}isLoaded(){return this.loaded}getInputExtension(e){const t=e.lastIndexOf(".");return t===-1?".opus":e.substring(t).toLowerCase()}}const N=new ae,T="shared-audio-file";class le{async getSharedFile(){try{const e=await caches.open("shared-files"),t=await e.match(T);if(t){const r=await t.blob(),s=t.headers.get("X-File-Name")||"audio.opus",i=new File([r],s,{type:r.type});return await e.delete(T),i}}catch(e){console.error("Error retrieving shared file:",e)}return null}async shareFile(e,t){if(!U())return!1;try{const s={files:[new File([e],t,{type:"audio/mpeg"})],title:t,text:"Áudio convertido para MP3"};if(navigator.canShare&&navigator.canShare(s))return await navigator.share(s),!0}catch(r){if(r instanceof Error&&r.name==="AbortError")return!1;console.error("Error sharing file:",r)}return!1}downloadFile(e,t){Z(e,t)}isShareTargetAvailable(){const e=new URLSearchParams(window.location.search);return e.has("share-target")||e.has("receiving-file-share")}clearShareParams(){const e=new URL(window.location.href);e.searchParams.delete("share-target"),e.searchParams.delete("receiving-file-share"),window.history.replaceState({},"",e.toString())}}const L=new le;class ce{constructor(){l(this,"currentFile",null);l(this,"conversionResult",null)}async init(){u.init(),this.setupEventHandlers(),await this.registerServiceWorker(),await this.checkForSharedFile()}setupEventHandlers(){u.setupDragAndDrop(e=>this.handleFileSelected(e)),u.setupFileInput(e=>this.handleFileSelected(e)),u.onConvertClick(()=>this.startConversion()),u.onCancelClick(()=>this.cancelConversion()),u.onRetryClick(()=>this.retryConversion()),u.onSelectAnotherClick(()=>this.reset()),u.onConvertAnotherClick(()=>this.reset()),u.onShareClick(()=>this.shareResult()),u.onDownloadClick(()=>this.downloadResult())}async registerServiceWorker(){if(!K()){console.warn("Service Worker not supported");return}try{const e=await navigator.serviceWorker.register("/sw.js",{scope:"./"});e.addEventListener("updatefound",()=>{const t=e.installing;t&&t.addEventListener("statechange",()=>{t.state==="installed"&&navigator.serviceWorker.controller&&console.log("New version available")})}),console.log("Service Worker registered")}catch(e){console.error("Service Worker registration failed:",e)}}async checkForSharedFile(){if(!L.isShareTargetAvailable())return;const e=await L.getSharedFile();e&&(L.clearShareParams(),this.handleFileSelected(e),await this.startConversion())}handleFileSelected(e){const t=G(e);if(!t.valid){u.showError(t.error||"Arquivo inválido");return}this.currentFile=e;const r=H(e);u.showFilePreview(r)}async startConversion(){if(!this.currentFile){u.showError("Nenhum arquivo selecionado");return}try{this.conversionResult=await N.convert(this.currentFile,e=>u.updateProgress(e)),this.conversionResult.success&&this.conversionResult.outputFile?u.showCompleted(this.conversionResult.outputFileName):u.showError(this.conversionResult.error||"Ocorreu um erro durante a conversão. Por favor, tente novamente.")}catch(e){const t=e instanceof Error?e.message:"Ocorreu um erro durante a conversão. Por favor, tente novamente.";u.showError(t)}}cancelConversion(){N.cancel(),this.reset()}async retryConversion(){this.currentFile?await this.startConversion():this.reset()}reset(){this.currentFile=null,this.conversionResult=null,u.resetToInitial()}async shareResult(){var t;if(!((t=this.conversionResult)!=null&&t.outputFile))return;await L.shareFile(this.conversionResult.outputFile,this.conversionResult.outputFileName)||this.downloadResult()}downloadResult(){var e;(e=this.conversionResult)!=null&&e.outputFile&&L.downloadFile(this.conversionResult.outputFile,this.conversionResult.outputFileName)}}document.addEventListener("DOMContentLoaded",()=>{new ce().init().catch(console.error)});
//# sourceMappingURL=main-DiU-rwSr.js.map
